<!DOCTYPE html>

<html>
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>

<head>
	<meta charset="UTF-8">
	<title>Canvas</title>

	<style type="text/css">
		body {
			background-color: white;
		}

		canvas {
			border-style: solid;
			border-width: 2px;
		}
	</style>

</head>

<body>

	<h1> Jose Ignacio Retamal </h1>

	<canvas id="canvas-for-ball"></canvas>

	<script type="text/javascript">

		// Gets a handle to the element with id canvasOne.
		var canvas = document.getElementById("canvas-for-ball");
		var canvasSize = {
			width: 800,
			height: 800
		}

		// Get a 2D context for the canvas.
		var ctx = canvas.getContext("2d");

		//change size of canvas.
		canvas.width = canvasSize.width;
		canvas.height = canvasSize.height;

		// The vertical location of the ball.
		var y = 10;
		var speedY = 1;
		// A function to repeat every time the animation loops.

		function repeatme() {

			//clear canvas
			ctx.clearRect(0, 0, 400, 400);

			// Draw the ball (stroked, not filled).
			ctx.beginPath();
			ctx.arc(50, y, 3, 0, 2 * Math.PI);
			ctx.stroke();

			// Update the y location.
			y += speedY;

			//change direction in edge
			if (y == 400 || y == 0) {
				speedY = speedY * (-1);
			}

			window.requestAnimationFrame(repeatme);

		}//function repeatme()

		// Get the animation going.
		//repeatme();



		class Ball {

			constructor(x, y, radius, speedX, speedY, slides) {

				//constructor variables
				this.radius = radius; //radius of the ball
				this.x = x; //x position center of the ball
				this.y = y; //y position center of the ball
				this.speedX = speedX; //vertical speed
				this.speedY = speedY; // horizontal speed
				this.slides = slides

				//other
				this.rotation = 0; //rotation increase
				this.isClockwise = false;  //rotation direction
				this.rotationSpeed = 0;

				this.gravity = 2.9;

			}//constructor

			//Draw ball in canvas
			draw() {
				//draw normal circle
				ctx.beginPath();
				ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);
				ctx.stroke();

			}//draw()

			//roatate the ball by the amount parameter in isClockwise direction
			rotate(amount) {
				if (this.isClockwise) {
					this.rotation += amount + this.rotasionSpeed;
				} else {
					this.rotation -= amount + this.rotationSpeed;
				}
			}


			drawBeachball() {
				//draw normal circle
				ctx.beginPath();
				ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);
				ctx.stroke();

				//draw first line from righ edge to center


				//fill circle
				ctx.fillStyle = "orange";

				ctx.fill();

				//draw lines

				//start angle for then increase
				var startAngle = 2 * Math.PI + this.rotation;

				//angle for increase so the ball can rotate
				var increaseAngle = (2 * Math.PI) / this.slides;

				//move cursor back to center
				ctx.moveTo(this.x, this.y);

				for (var i = 0; i < this.slides; i++) {

					//draw line
					ctx.lineTo(this.x + this.radius * Math.cos(startAngle), this.y + this.radius * Math.sin(startAngle));

					//move cursor back to center
					ctx.moveTo(this.x, this.y);

					//increase angle
					startAngle += increaseAngle;

				}//end for loop

				//stroke pat
				ctx.stroke();

				//draw small inner circle
				ctx.beginPath();
				ctx.arc(this.x, this.y, this.radius * 0.95, 0, 2 * Math.PI);
				ctx.stroke();

			}//end drawBeachball() 

			move() {
				this.speedY +=this.gravity;
				//increse/decrease x and y by the speed
				this.x += this.speedX ;
				this.y += this.speedY;

				//change direction when reach canvas  horizontal border
				
				if (this.y >= (canvasSize.height - this.radius) ) {

					//bounse
					this.speedY -= 0.2;
					this.speedY = Math.abs(this.speedY);
					this.changeYDirection();

					//this.invertRotation();

				}
				if(this.y > (canvasSize.height - this.radius) ) {
					this.y = (canvasSize.height - this.radius);
				}

				if(this.y == (0 + this.radius)) {
					this.speedY = (-1)*Math.abs(this.speedY);
					
				}

				//change direction when reach canvas  vertical border
				//right
				if (this.x >= (canvasSize.width - this.radius) ) {

					this.changeXDirection();

					//this.invertRotation();

				}
				//bottom
				if(this.x <= (0 + this.radius)) {
					this.changeXDirection();
				}


			}//end move()

			//for resize
			resize(radius) {
				this.radius = radius;

			}//resize(x,y)

			changeYDirection() {
				this.speedY = this.speedY * (-1);
			}

			changeXDirection() {
				this.speedX = this.speedX * (-1);
			}

			invertRotation() {

				if (this.isClockwise) {

					this.isClockwise = false;

				} else {

					this.isClockwise = true;
				}

			}//end of invertRotation()

			changeXSpeed(amount) {

				this.speedX += amount;
			}

		}//end of class Ball

		//create a new ball
		var myBall = new Ball(80, 80, 80, 2, 3, 7);

	var myBall1 =  new Ball(80, 80, 80, 4, 4, 7);
		//funtion for call recursively
		function repeatBallBounce() {

			//clear canvas
			ctx.clearRect(0, 0, canvasSize.width, canvasSize.height);

			//ball actions
			myBall.rotate(0.01);
			myBall.move();

			myBall.drawBeachball();

			myBall1.rotate(0.01);
			myBall1.move();
			myBall1.drawBeachball();

			//recursive call
			window.requestAnimationFrame(repeatBallBounce);

		}//function repeatBallBounce()

		//start recursive call
		repeatBallBounce();

		//key event

		// Add a Javascript event listener to the keypress event.
		window.addEventListener("keypress", function (event) {
			// Just log the event to the console.

			console.log(event);
			/*
			//right arrow
			if (event.keyCode == 39) {
				myBall.speedX += 1;
				console.log("here");
			}*/
		});

		$(document.body).on('keydown', function (e) {
			console.log(e.which);
			switch (e.which) {
				// key code for left arrow
				case 37:
					console.log('left arrow key pressed!');
					myBall.speedX -= 1;

					break;

				// key code for right arrow
				case 39:
					console.log('right arrow key pressed!');
					myBall.speedX += 1;
					break;
				// key up pressed
				case 38:
					myBall.speedY -= 5;
					break;
				//key down pressed
				case 40:
					myBall.speedY += 1;
					console.log('top arrow key pressed!');
					break;

				case 82://left
					myBall.rotationSpeed += 10;
					console.log('r key pressed!');
					break;
				case 80: //right
					console.log('p arrow key pressed!');
					myBall.rotationSpeed -= 10;
					break;

			}
		});

		//mouse event
		var canvasPosition = {
			x: canvas.offsetLeft,
			y: canvas.offsetTop
		}
		canvas.addEventListener("click", function (event) {


			var mouse = {
				x: event.pageX - canvasPosition.x,
				y: event.pageY - canvasPosition.y
			}


			myBall.x = mouse.x;
			myBall.y = mouse.y;
			myBall.draw();

			noClicks += 1;
			console.log(noClicks);


		});

		//second ball
	

	</script>

</body>

</html>